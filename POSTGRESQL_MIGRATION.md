# üêò PostgreSQL Migration Guide

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `asyncpg` –∏ `psycopg2-binary` –≤ `requirements.txt`
2. ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `database/models.py` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PostgreSQL
3. ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `render.yaml` —Å `DATABASE_URL`
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `DATABASE_URL`
5. ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `init_db.py`

---

## üöÄ Deployment –Ω–∞ Render:

### –®–∞–≥ 1: –ü—É—à –Ω–∞ GitHub

```bash
git add .
git commit -m "–ú–ò–ì–†–ê–¶–ò–Ø –ù–ê POSTGRESQL: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL + SQLite –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
git push origin main
```

### –®–∞–≥ 2: Deploy –Ω–∞ Render

1. –ó–∞–π–¥–∏ –≤ **Render Dashboard**
2. –û—Ç–∫—Ä–æ–π —Å–≤–æ–π —Å–µ—Ä–≤–∏—Å **diia-backend**
3. **Clear build cache & deploy**
4. –î–æ–∂–¥–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è (3-5 –º–∏–Ω—É—Ç)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π:
```
https://diia-backend.onrender.com/api/health
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: `{"status":"ok","message":"Server is running"}`

---

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:

### –î–ª—è SQLite (–ª–æ–∫–∞–ª—å–Ω–æ):

–°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª:
```env
DATABASE_URL=database/diia.db
BOT_TOKEN=your_bot_token
ADMIN_IDS=your_telegram_id
CRYPTOPAY_TOKEN=your_token
CLOUDINARY_CLOUD_NAME=djoszn8zc
CLOUDINARY_API_KEY=472899494355635
CLOUDINARY_API_SECRET=gGgIhXupY9im376HqlyCwNhZe-c
```

–ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:
```bash
python bot/bot.py
```

### –î–ª—è PostgreSQL (–ª–æ–∫–∞–ª—å–Ω–æ):

–í `.env` —É–∫–∞–∂–∏:
```env
DATABASE_URL=postgresql://postdia_user:kkRbzuUDLdnDvSUym3PvulCHtI815RQq@dpg-d3v8t5hr0fns73c9tq9g-a/postdia
```

–ó–∞–ø—É—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é:
```bash
python init_db.py
```

---

## üìä –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:

### –í–µ–± –∞–¥–º–∏–Ω–∫–∞:

1. –û—Ç–∫—Ä–æ–π `admin/index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í–æ–π–¥–∏ (admin / admin123)
3. –£–≤–∏–¥–∏—à—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ PostgreSQL

### –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞:

```bash
python admin_panel.py
```

–†–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–æ–π –ë–î, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑–∞–Ω–∞ –≤ `DATABASE_URL`.

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ:

–ö–æ–¥ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** —Ç–∏–ø –ë–î –ø–æ URL:

- **SQLite**: `database/diia.db` –∏–ª–∏ `sqlite:///path/to/db.db`
- **PostgreSQL**: `postgresql://user:pass@host/db`

–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ –Ω–µ –Ω—É–∂–Ω–æ!

---

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

### database/models.py
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –∏ SQLite
- ‚úÖ Connection pooling –¥–ª—è PostgreSQL
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ë–î –ø–æ URL
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –æ–±–∞ –¥–≤–∏–∂–∫–∞

### render.yaml
- ‚úÖ `DATABASE_PATH` ‚Üí `DATABASE_URL`
- ‚úÖ PostgreSQL URL –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –í—Å–µ —Ñ–∞–π–ª—ã (bot.py, render_server.py, api/main.py, admin_panel.py)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç `DATABASE_URL` –≤–º–µ—Å—Ç–æ `DATABASE_PATH`

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

1. **–î–∞–Ω–Ω—ã–µ –ù–ï –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
   - –°—Ç–∞—Ä–∞—è SQLite –ë–î –Ω–∞ Render **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
   - PostgreSQL –ë–î **–ø—É—Å—Ç–∞—è** - –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞

2. **–ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π**:
   - –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
   - –ë–æ—Ç –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

3. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**:
   - SQLite –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–±—ã—Å—Ç—Ä–æ, —É–¥–æ–±–Ω–æ)
   - PostgreSQL –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ **–ü—É—à –Ω–∞ GitHub** (—Å–º. –≤—ã—à–µ)
2. ‚úÖ **Deploy –Ω–∞ Render** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
3. üîÑ **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–Ω–æ–≤–æ** —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
4. ‚úÖ **–í—ã–¥–∞–π –ø–æ–¥–ø–∏—Å–∫–∏** —á–µ—Ä–µ–∑ –≤–µ–± –∞–¥–º–∏–Ω–∫—É –∏–ª–∏ –∫–æ–Ω—Å–æ–ª—å–Ω—É—é

---

## üÜò Troubleshooting:

### –û—à–∏–±–∫–∞: "no module named asyncpg"
```bash
pip install asyncpg psycopg2-binary
```

### –û—à–∏–±–∫–∞: "connection refused"
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ PostgreSQL URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£–±–µ–¥–∏—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω

### –ë–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä—å `.env` —Ñ–∞–π–ª
- –£–±–µ–¥–∏—Å—å —á—Ç–æ `DATABASE_URL` —É–∫–∞–∑–∞–Ω

### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –£–±–µ–¥–∏—Å—å —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å `admin/index.html` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ URL (Render –∏–ª–∏ localhost)

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –∏—Å—á–µ–∑–Ω—É—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ)
‚úÖ –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º SQLite –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ SQLite
‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

